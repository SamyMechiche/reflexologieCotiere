{% extends 'base.html.twig' %}

{% block title %}Prendre rendez-vous{% endblock %}

{% block body %}
<div class="example-wrapper" style="max-width: 800px; margin: 2em auto;">
    <h1>Choisissez un créneau disponible</h1>
    {% if success %}
        <div style="background:#d4edda; color:#155724; padding:1em; border-radius:6px; margin-bottom:1em;">Votre rendez-vous a bien été réservé !</div>
    {% elseif error %}
        <div style="background:#f8d7da; color:#721c24; padding:1em; border-radius:6px; margin-bottom:1em;">{{ error }}</div>
    {% endif %}
    <table class="table" style="width:100%; background:#fff; border-radius:8px;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Heure de début</th>
                <th>Heure de fin</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        {% for slot in slots %}
            <tr>
                <td>{{ slot.date|date('d/m/Y') }}</td>
                <td>{{ slot.startTime|date('H:i') }}</td>
                <td>{{ slot.endTime|date('H:i') }}</td>
                <td>
                    <form method="post" action="{{ path('app_appointment', {'slotId': slot.id}) }}">
                        <select name="session_id" required style="width: 180px; margin-right: 1em;">
                            <option value="">Choisir une séance</option>
                            {% for session in sessions %}
                                <option value="{{ session.id }}">{{ session.name }}</option>
                            {% endfor %}
                        </select>
                        <input type="text" name="comment" placeholder="Soucis de santé potentiel (optionnel)" style="width: 200px; margin-right: 1em;">
                        {% if app.user %}
                            <button type="submit">Réserver</button>
                        {% else %}
                            <input type="text" name="name" placeholder="Votre nom" required style="width: 120px;">
                            <input type="email" name="email" placeholder="Votre email" required style="width: 180px;">
                            <button type="submit">Réserver</button>
                        {% endif %}
                    </form>
                </td>
            </tr>
        {% else %}
            <tr><td colspan="4">Aucun créneau disponible pour le moment.</td></tr>
        {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
